#!/bin/bash
# Deps: curl, jq, xclip, imagemagick

_notify() {
    local icon
    if [ -z "$3" ]; then
        icon="$HOME/.config/dunst/assets/notification/scrot.png"
    else
        icon="$3"
    fi

    notify-send -a "Screenshot Tool" -i "$icon" "$1" "$2"
}

_cleanup() {
    sleep && rm -f "$1"
}

# Voidchan is dead. Use p3ac CDN instead.
# Discord Invite: https://discord.gg/7PAuNhQGGJ
key=""
url=""

if [[ $(file --mime-type -b $1) != "image/png" ]]; then
    _cleanup $1
    _notify "Screenshot aborted." && exit 1
fi

imageURL=$(curl -X POST -H "Content-Type: multipart/form-data" -H "Authorization: $key" -F "file=@$1" "$url" | jq -r '.files[].url')
echo -n $imageURL | xclip -sel c
canberra-gtk-play -i "camera-shutter"
_notify "Screenshot uploaded and copied to clipboard." "" $1 && _cleanup $1
